<% include thead.html %>
<body>  
  <% include tnavi.html %>

    <div class="container">      
        <div class="panel panel-default">
          <div class="panel-heading" role="tab" id="headingOne">
            <h4 class="panel-title">
              <a data-toggle="collapse" data-parent="#accordion" href="#outline-panel" aria-expanded="true" aria-controls="outline-panel">
                <span class="glyphicon glyphicon-book"></span> 展开藏品目录
              </a>
              <% if( opt.message && opt.message != "" ){ %>
                系统公告 : <%- opt.message %>
              <% } %>
            </h4>
          </div>
          <div id="outline-panel" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingOne">
            <div class="panel-body"  style="height: 400px; overflow-y: scroll;">
              <div class="col-sm-12 col-md-12">
                <h4 id="top">藏品目录</h4>
                <h3 id="outline-navi" class="age-navi"></h3>
                <hr>
                <div id="outline-dlg"></div>
              </div>
            </div>
          </div>
        </div>

        <div id="paintinglist" class="col-sm-12 col-md-12">
          <div id="paintingListRow" class="row"></div>
          <!-- 图片列表模版 -->
          <script type="text/html" id="paintinglistTmpl">
              <h3 id="essenceHref" class="href"><span class="label label-info"><@=label @></span></h3>
              <div class="row">
              <@
              var rowcnt = 0; 
              for(i = 0; i<= cagstore.length - 1; i++ ){ 
                  var painting = cagstore[i],
                      uuid = painting._id,
                      col = Math.floor(painting.snapSize.width / 128) * 2 ,
                      page = isMobile ? 'imglite' : 'img' ,
                      link = page + '/' + uuid ,
                      pixels = (painting.pixels ? painting.pixels.replace(/\..*$/,'') + "万像素" : painting.fileSize);
                    
                    
                    var levelmap = ['五级-普清','四级-半高清','三级-高清','二级-超高清','一级-如实物','特级-超实物','特级-超实物','特级-超实物','特级-超实物'],
                       scalelevel = painting.maxlevel - painting.minlevel,
                       paintinglevel = levelmap[scalelevel];

                    var newrow = (rowcnt + col) > 12 ;
                    if(newrow){
                      rowcnt = col ;
                    } else {
                      rowcnt += col ;
                    }

                    var isVeritcal = (painting.snapSize.height / painting.snapSize.width) > 1;
              @>
                
                <div id="<@=uuid @>" class="painting col-sm-12 col-md-6" data-uuid="<@=uuid @>" 
                    style="padding-right: 15px; padding-left: 15px;">
                  <div class="thumbnail col-sm-12 col-md-12" <@= opacity ? "style=\"opacity: 0;\"":"" @> >
                    <a target="img-window" class="col-sm-12 <@=isVeritcal? 'col-md-6 img-div' : 'col-md-12 img-div-h' @>" href="<@=link @>">
                      <img style="
                          width: <@=painting.snapSize.width @>px; height: <@=painting.snapSize.height @>px; 
                          "
                        class="lazy" data-original="<@=cdn @>/cagstore/<@=uuid @>/tb.jpg"
                        alt="<@=painting.paintingName @>"
                        ></a>
                    <div class="caption <@=isVeritcal? 'col-md-6' : 'col-md-12' @>">
                      <h4><a href="<@=link @>"><@=painting.paintingName @></a><span class="label label-info pull-right"><@=paintinglevel @></span></h4>
                      <@ if(painting.essence && painting.essenceComment ) { @>
                        <p><@=painting.essenceComment @></p>
                      <@} @>
                      <p><@=painting.age + " " + painting.author @><span class="pull-right"><@=(painting.areaSize ? painting.areaSize.toLowerCase() +' 厘米' : '' ) @></span></p>
                      <p><@=pixels @></p>
                      <p>
                      <span class="label label-default"><@=painting.viewCnt ? '观摩' + painting.viewCnt + '次' : '新发布' @></span>
                      <@= painting.descUrl ? '<a target="infowindow" class="pull-right" href="' + painting.descUrl + '"><span class="glyphicon glyphicon-info-sign"></span>介绍</a>' : '' @>
                      <@ if(painting.offlineUrl){ @>
                        <a target="downloadwindow" data-trigger="hover" data-placement="bottom" data-toggle="popover" title="什么是网页离线包" data-content="为了方便您随时随地观赏藏品，或者是分享图片给朋友，我们把网页和图片压缩成了“网页离线包”，下载离线包后解压成目录，双击打开其中的“jpg.html”文件即可。" class="pull-right download" href="<@= painting.offlineUrl @>"><span class="glyphicon glyphicon-cloud-download"></span>下载</a>
                      <@ } @>
                      <@ if( painting.desc) { @>
                        <p><@=painting.desc @></p>
                      <@ } @>
                    </div>
                  </div>
                </div>
            <@ } @>
            </div>
            </script> <!-- 图片列表模版 -->


          <script type="text/html" id="outlineDlgTmpl">
            <@
            for(i = 0; i<= outline.length - 1; i++ ){ 
                var ageAuthor = outline[i],
                    ageName = ageAuthor._id,
                    authors = ageAuthor.authors;
            @>
            <h3>
              <a href="#type=age&age=<@=ageName @>" data-age="<@=ageName @>">
                <span class="label label-info"><@=ageName @></span></a>
              <a href="#" data-target="top" class="pull-right scroll-view h4">
                <span class="label label-default">返回顶部</span></a>
            </h3>
              <@
              for(j = 0 ; j <= authors.length - 1; j++){
                    var author = authors[j],
                        authorName = author.name,
                        paintingCnt = author.paintings.length;
                @>
                  <p>
                  <a href="#type=age&age=<@=ageName @>&author=<@=authorName @>" data-target="#author-<@=authorName @>" class="change-view"><span class="label label-default"><@=authorName + " " + paintingCnt + "幅" @></span>
                  <@
                  for(k = 0 ; k <= author.paintings.length - 1; k++){
                    pname = author.paintings[k];
                  @>
                  《<@=pname @>》
                  <@}@>
                  </a>
                  </p>
              <@ } @> 
              </div>
            <@ } @>
          </script>

          <script type="text/html" id="outlineNavTmpl">
            <@
            for(i = 0; i<= outline.length - 1; i++ ){ 
                var ageAuthor = outline[i],
                    ageName = ageAuthor._id,
                    authors = ageAuthor.authors;
            @>
              <a href="#" class="scroll-view" data-target="<@=ageName @>"><span class="label label-info"><@=ageName @></span></a>
            <@ } @>
          </script>
      </div>
    </div>

<!-- Placed at the end of the document so the pages load faster -->
<script type="text/javascript"> function _cdn(res){ return "<%= conf.cdn_url %>"+ (res|| "") }</script>
<%
if( target === 'release' ){ %>
    <script src="http://cdn.staticfile.org/jquery/1.8.3/jquery.min.js" type="text/javascript"></script>
    <script src="http://cdn.staticfile.org/twitter-bootstrap/3.1.1/js/bootstrap.min.js" type="text/javascript"></script>
    <script src="http://cag.share-net.cn/js/cag_<%=stamp %>_min.js" type="text/javascript"></script>
    <script src="http://cag.share-net.cn/js/main_<%=stamp %>_min.js" type="text/javascript"></script>
<% } else { %>
    <script src="/js/jquery.js" type="text/javascript"></script>
    <script src="/js/bootstrap.js" type="text/javascript"></script>
    <!-- cag_xxx_min.js -->
    <script src="/js/jquery.lazyload.js" type="text/javascript"></script>
    <script src="/js/sharepage.base.js"></script>
    <script src="/js/sharepage.js"></script>
    <script src="/js/cagcommons.js"></script>
    <!-- main_xxx_min.js -->
    <script src="/js/main.js"></script><% 
   } 
%>

<% include tfootnavi.html %>
<% include tfoot.html %>
